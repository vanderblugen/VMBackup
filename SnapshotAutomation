# This is run every 12 hours snapshot of hyper-v vm

# Removes old snapshots according to NumberOfBackupsToKeep and 
# Backups up the HyperVName and puts them into FolderName
# It also writes to the EventViewer

$NumberOfDaysOld = 14
$HyperVName = "WHATEVER"
$Application = "12 Hour $HyperVName HyperV Snapshot"
$Message = "Removed snapshots of $HyperVName older than $NumberOfDaysOld and Created a New Snapshot"

New-EventLog -LogName Application -Source $Application
# After running one time, this line may produce an error, this is normal

Remove-VMSnapshot (Get-VMSnapshot -VMName $HyperVName | Where-Object {$_.CreationTime -lt (Get-Date).AddDays(-$NumberOfDaysOld)})
Checkpoint-VM -Name $HyperVName -SnapshotName "$HyperVName - $(Get-Date -Format "yyyyMMdd hhmm")"
Write-EventLog -LogName "Application" -Source $Application -EventID 3001 -EntryType Information -Message $Message


# I am not claiming to create this entirely by myself.  A portion of this was obtained from [here](https://www.logitblog.com/automated-hyper-v-vm-snapshots-with-powershell)
